#!/bin/sh

set -e

## debug
if [[ "$DOCKER_ABUILD_DEBUG" = "true" ]]; then
  set -x
  PS4='$LINENO: '
fi

DOCKER_VOLUMES="
    -v $PWD:/cwd
    -v ${HOME}/.abuild:/home/builder/.abuild
    -v ${HOME}/.abuild/.cache:/var/cache/apk
    -v ${HOME}/.abuild/.distfiles:/var/cache/distfiles
    -v ${PWD%aports/*}aports:/home/builder/aports
    -v ${PWD%aports/*}packages:/home/builder/packages
"

DOCKER="docker run -ti $DOCKER_VOLUMES -e DOCKER_ABUILD_DEBUG mor1/abuild"
$DOCKER "$@"
