#!/bin/sh

readonly cmd=$1

manage_config() {
	docker run --user 1000:1000 --rm -it --workdir /mnt/abuild \
		-v dabuild-config:/mnt/abuild alpine sh
}

list_volumes() {
	docker volume ls --quiet --filter name="^dabuild"
}

enable_multiarch() {
	docker run --rm --privileged multiarch/qemu-user-static \
		--reset --persistent yes --credential yes
}

usage() {
	cat <<- EOF
	dabuild: version (unknown)

	Available commands:
	  config: access abuild configuration
	  volumes: list created dabuild volumes
	  multiarch: enable docker multi-arch support
	  help: this help screen
	EOF
}


case $cmd in
	config) manage_config;;
	volumes) list_volumes;;
	multiarch) enable_multiarch;;
	help) usage;;
	*) usage; exit 1;;
esac
